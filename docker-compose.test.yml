# =============================================================================
# Condorcet Desktop â€” Docker Compose override for local image testing
# =============================================================================
#
# Overrides docker-compose.yml to test the production image locally without
# affecting a running production deployment. Uses the same .env file as prod.
#
# Usage:
#   docker compose -f docker-compose.yml -f docker-compose.test.yml up --build
# =============================================================================

services:
  app:
    # Local validation mode: run without TLS so localhost testing is stable and
    # does not depend on local certificate trust / ACME behavior.
    command: >
      sh -c "php artisan config:cache &&
             php artisan route:cache &&
             php artisan view:cache &&
             php artisan event:cache &&
             exec php artisan octane:frankenphp --host=0.0.0.0 --port=80 --workers=auto --max-requests=1000"
    ports:
      # Map HTTP to an unprivileged host port for local image testing.
      - "8000:80"
